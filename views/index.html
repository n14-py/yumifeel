<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YumiFeel - Conecta con tu pareja</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

    <div class="app-container">

        <%- include('partials/header.html') %>

        <main class="app-content" id="app-content">

            <% if (view === 'link-partner') { %>
            
                <div class="form-container" style="padding: 0; background: none; border: none;">
                    <div class="auth-header" style="margin-bottom: 1rem;">
                        <h2>Vincular Cuenta</h2>
                        <p>Con茅ctate con tu pareja para empezar a chatear con Yumi.</p>
                    </div>

                    <% if (locals.error) { %>
                        <div class="alert alert-danger"><%= error %></div>
                    <% } %>
                    <% if (locals.success) { %>
                        <div class="alert alert-success"><%= success %></div>
                    <% } %>

                    <form action="/link-partner" method="POST">
                        <div class="form-group">
                            <label for="partnerCode">Ingresa el c贸digo de tu pareja:</label>
                            <input type="text" id="partnerCode" name="partnerCode" class="form-control" placeholder="ABC123" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Vincular</button>
                    </form>

                    <hr style="border-color: var(--border-color); margin: 2rem 0;">

                    <div style="text-align: center;">
                        <label>O comparte tu c贸digo:</label>
                        <input type="text" class="form-control" value="<%= invitationCode %>" readonly style="font-size: 1.5rem; font-weight: bold; text-align: center; letter-spacing: 2px; margin-top: 0.5rem; background-color: var(--background-color);">
                        <small style="color: var(--text-muted-color);">P铆dele a tu pareja que ingrese este c贸digo.</small>
                    </div>
                </div>

            <% } else if (view === 'chat') { %>

                <div class="chat-messages" id="chat-messages">
                    <div class="message ai">
                        <div class="message-content">
                            隆Hola <%= currentUser.name %>!  Soy Yumi. Estoy aqu铆 para escucharte. Cu茅ntame c贸mo te sientes o qu茅 te gustar铆a hablar sobre tu relaci贸n con <%= partner.name %>.
                        </div>
                    </div>
                    
                    <% messages.forEach(msg => { %>
                        <div class="message <%= msg.isFromAI ? 'ai' : 'user' %>">
                            <div class="message-content">
                                <%= msg.text %>
                                <div class="message-time"><%= new Date(msg.createdAt).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }) %></div>
                            </div>
                        </div>
                    <% }); %>
                </div>

            <% } %>
        
        </main>

        <% if (view === 'chat') { %>
            <footer class="chat-input-area">
                <form class="chat-form" id="chat-form">
                    <input type_="text" id="msg-input" placeholder="Escribe c贸mo te sientes..." autocomplete="off" class="form-control">
                    <button type="submit" id="send-btn" title="Enviar">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </footer>
        <% } %>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        const currentUserID = "<%= currentUser._id %>";
        const currentCoupleID = "<%= currentUser.coupleId %>";
    </script>
    
    <script src="/js/app.js"></script>

</body>
</html> 
